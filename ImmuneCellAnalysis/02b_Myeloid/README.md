## Analysis of myeloid scRNAseq

Overall approach:
1) De novo NMF for pediatric myeloid cells. 
2) Correlate with adult GBM 10X to help annotate
3) Identify higher-level cell types (macrophage/microglia) across programs. 
4) Compare programs (+ cells types) to adult myeloid cells (SmartSeq2 IDHmut/GBM datasets). 



***01a_NMF***
	- Ran NMF locally for myeloid cells, as well as with Cycling set as separate program (this option not used downstream)
	- programs plotted in NMF_plots.Rmd (heat maps, UMAP, etc
	- Correlate ped programs with adult gbm 10x to help annotate. Correlated with both primary and recurrent tumors from adult GBM 10X dataset, but recurrent used downstream.
	-Tested different numbers of repeats (10/30/50) in NMF_10vs30vs50_repeats.Rmd. For myeloid cells at least (nothing else tested), there was no real difference between number of repeats, so 10x used downstream.

***01b_Ped.Adult.NMF***
	- Run de novo NMF on adult myeloid cells (smartseq2, idhmut, gbm) in ***AdultCohorts_DeNovoNMF.Rmd***. Two main options here- separately for IDHmut/GBM, or merged for IDHmut/GBM. Tried to assess which makes more sense (which represents cluster split better, etc) and decided to use the merged option (i.e., merging idhmut/gbm adult myeloid count matrix —> running NMF) moving forward.
	- Run de novo NMF on merged ped/adult myeloid count matrix in Ped.Adult_merged_NMF.Rmd. This option not used downstream- decided that running separately for ped/adult then correlating made more sense.

***01c_Liger***
	Run integrative NMF (liger) on pediatric myeloid cells. correlate with NMF programs. Main purpose here is to help inform the number of programs to use.

***02_AdditionalAnnotation***
	- No ordering to these Rmd files, none depend on others
	- Used for additional levels of annotation (primarily microglia/macropahge) on top of programs. Also compare programs to these cell types to help annotate programs- some are exclusively microglia/macrophage, others are a mix
	
Info for each file:
***Microglia.vs.Macrophage.Rmd***
		Used microglia/macrophage geneses from Li- scored ped myeloid, various visualizations. Compare to myeloid NMF programs

***MgTAM.vs.MoTAM.Rmd***
		Similar to microglia vs macrophage, but using geneses from Adult GBM 10X paper (supplemental table comparing mgTAM vs MoTAM)

***AdultGBM10X_Mo.Mg.Mono.Prol_AnnotatePed.Rmd***
		Similar to above, but using geneses from adult GBM 10X paper- generated by me. Set all cells as either mgTAM, moTAM, cycling, monocytes, then FIndAllMarkers. These markers generated in 01_Preprocessing/03_PreprocessAdultDatasets and used here.

***Artifact_Stevens2020.Rmd***
		Stevens et al 2020 described artifact in myeloid cells generated by enzymatic dissociation. Used this geneset here, scored myeloid cells, compared to programs- are any of our programs potentially artifacts? Stress_Response shows correlation, but weaker than in paper- may just be microglia

***FunctionalMyeloidMarkers_FromLi.Rmd***
		Li sent markers from a paper that described functional states in myeloid cells. Scored these here, compared to myeloid programs. No clear correlation, not used downstream
		
***03_CompareToAdult***
	Overall goal of analyses in this folder are to compare the proportion of programs and cell types in adult vs ped myeloid cells

Analyses in this folder:
***01_Merge_AssessIntegration.Rmd***: merges ped/adult myeloid cells into single object for later use. Compare integration of ped/adult on UMAP. This helped to determine that ped/adult don’t form distinct clusters, and that, in general, we expect PROPORTIONS of cell states to vary, but not necessarily cell states themselves. 
	
***02a_CompareProgramProportions_PedNMF.Rmd***: The simplest way of comparing cell states. Score ped/adult for ped programs (generated in 01a_NMF/NMF.Rmd and annotated in ***01a_NMF/02a_AdultGBM10X_AnnotatePed_Recurrent***), then compare breakdown of these programs. Because adult cells score quite lowly for these ped programs, determined that this was not most appropriate route- need to generate programs that are more representative of both ped and adult myeloid cells.

***02b_CompareProgramProportions_CorrelateAdult.Ped.NMF.Rmd***: One approach for generating programs that are more representative of both ped and adult myeloid cells- run NMF separately on ped/adult (***NMF/Adult/Myeloid/AdultCohorts_DeNovoNMF.Rmd***) myeloid cells, then use this to determine shared/specific programs. Drawback of this approach: difficult to control for both subtype and age in this analysis. The differences found in adult, for example, may be due to the fact that these programs were generated on a dataset that includes a lot of IDHmut cells, which is not in ped.

***02c_CompareProgramProportions_MergedAdult.PedNMF.Rmd***: Another approach for generating programs that are more representative of both ped and adult myeloid cells- run NMF on ped/adult myeloid cell simultaneously (***NMF/Adult/Myeloid/Ped.Adult_merged_NMF.Rmd***), then use these programs to score myeloid cells and compare proportions. This approach may be better than the previous- reduces chance that programs are subtype-specific. Less subjective, as it doesn’t require merging some programs into “shared” and keeping some as “specific”. One drawback- Phago and IFN programs are not well represented here. A few options for dealing with this are included in the file.

***03_Macrophage.Microglia_CompareProportions***
	Compare proportion of macrophage/microglia in ped vs adult (based on marker gene expression)
